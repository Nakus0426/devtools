{{{commentText}}}
import { Alova, AlovaMethodCreateConfig, Method } from 'alova';
import type { $$userConfigMap, alovaInstance } from '.';
import type apiDefinitions from './apiDefinitions';

type CollapsedAlova = typeof alovaInstance;
type UserMethodConfigMap = typeof $$userConfigMap;

type Alova2MethodConfig<Responded> =
  CollapsedAlova extends Alova<any, any, infer RequestConfig, any, infer ResponseHeader>
    ? AlovaMethodCreateConfig<any, Responded, RequestConfig, ResponseHeader>
    : never;

// Extract the return type of transformData function that define in $$userConfigMap, if it not exists, use the default type.
type ExtractUserDefinedTransformed<
  DefinitionKey extends keyof typeof apiDefinitions,
  Default
> = DefinitionKey extends keyof UserMethodConfigMap
  ? UserMethodConfigMap[DefinitionKey]['transformData'] extends (...args: any[]) => any
    ? Awaited<ReturnType<UserMethodConfigMap[DefinitionKey]['transformData']>>
    : Default
  : Default;
type Alova2Method<
  Responded,
  DefinitionKey extends keyof typeof apiDefinitions,
  CurrentConfig extends Alova2MethodConfig<any>
> =
  CollapsedAlova extends Alova<infer State, infer Export, infer RequestConfig, infer Response, infer ResponseHeader>
    ? Method<
        State,
        Export,
        CurrentConfig extends undefined
          ? ExtractUserDefinedTransformed<DefinitionKey, Responded>
          : CurrentConfig['transformData'] extends (...args: any[]) => any
            ? Awaited<ReturnType<CurrentConfig['transformData']>>
            : ExtractUserDefinedTransformed<DefinitionKey, Responded>,
        any,
        RequestConfig,
        Response,
        ResponseHeader
      >
    : never;

{{#schemas}} 
{{{.}}} 
{{/schemas}}
declare global {
  interface APIS {
    {{#pathApis}}
    {{{tag}}}: {
     {{#apis}}
      /**
       * ---
       *
       * [{{{method}}}]{{{summary}}}
       *
       * **path:** {{{path}}}
       *
      {{#if pathParameters}}
       * ---
       *
       * **Path Parameters**
       * ```ts
       * interface PathParameters {
      {{#pathParameters}}
       *   // {{{description}}}
       {{#required}}
       *   // required: true
       {{/required}}
       {{#deprecated}}
       *  // [deprecated]
       {{/deprecated}}
       *   {{{key}}}: {{{type}}};
      {{/pathParameters}}
       * }
       * ```
       *
       {{/if}}
       {{#if queryParameters}}
       * ---
       *
       * **Query Parameters**
       * ```ts
       * interface QueryParameters {
       {{#queryParameters}}
       *   // {{{description}}}
       {{#required}}
       *   // required: true
       {{/required}}
       {{#deprecated}}
       *  // [deprecated]
       {{/deprecated}}
       *   {{{key}}}: {{{type}}};
       {{/queryParameters}}
       * }
       * ```
       *
       {{/if}}
       {{#if requestName}}
       * ---
       *
       * **RequestBody**
       * ```ts
       {{#isType requestBody "array"}}
       * interface RequestBody {
       {{#requestBody}}
       *   // {{{description}}}
       {{#required}}
       *   // required: true
       {{/required}}
       {{#deprecated}}
       *  // [deprecated]
       {{/deprecated}}
       *   {{{key}}}: {{{type}}};
       {{/requestBody}}
       {{/isType}}
       {{#isType requestBody "object"}}
       * type RequestBody = {{{requestBody.type}}}
       {{/isType}}
       * }
       * ```
       *
       {{/if}}
       {{#if response}}
       * ---
       *
       * **Response**
       * ```ts
       {{#isType response "array"}}
       * interface Response {
       {{#response}}
       *   // {{{description}}}
       {{#deprecated}}
       *  // [deprecated]
       {{/deprecated}}
       *   {{{key}}}: {{{type}}};
       {{/response}}
       * }
       {{/isType}}
       {{#isType response "object"}}
       * type Response = {{{response.type}}}
       {{/isType}}
       * ```
       *
       {{/if}}
       * ---
       */
      {{{name}}}<Config extends Alova2MethodConfig<{{{responseName}}}> & {
          {{#if pathParameters}}
          pathParams: {
            {{#pathParameters}}
            {{#if description}}
           /**
            *{{{description}}} 
            */
            {{/if}}
            {{{key}}}: {{{type}}}; 
            {{/pathParameters}}
          };
          {{/if}}
          {{#if queryParameters}}
          params: {
            {{#queryParameters}}
            {{#if description}}
           /**
            *{{{description}}} 
            */
             {{/if}}
            {{{key}}}: {{{type}}};
            {{/queryParameters}}
          };
          {{/if}}
          {{#if requestName}}
          {{#isType requestBody "array"}}
          data: {
            {{#requestBody}}
            {{#if description}}
           /**
            *{{{description}}} 
            */
            {{/if}}
            {{{key}}}: {{{type}}};
            {{/requestBody}}
          };
          {{/isType}}
          {{#isType requestBody "object"}}
          data: {{{requestBody.type}}};
          {{/isType}}
          {{/if}}
        }>(
        config?: Config
      ): Alova2Method<{{{responseName}}}, '{{{pathKey}}}', Config>;
     {{/apis}}
    };
    {{/pathApis}}
  }

  var Apis: APIS;
}